---
import AdminLayout from "@/layouts/AdminLayout.astro";
import { authMiddleware } from '@middlewares/auth.ts';

// Aplicar el middleware
const response = await authMiddleware(Astro, async () => {
  // Si el middleware pasa, renderiza la página
  return new Response(null, {status: 200});
});

// Si el middleware devuelve una redirección, seguirla
if (response instanceof Response && response.headers.get('Location')) {
  return Astro.redirect(response.headers.get('Location') || '/', response.status);
}
---

<AdminLayout title="Dashboard">
    <h1 class="text-center mt-10 dark:text-neutral-200">Dasboard</h1>
</AdminLayout>


<script>
    import {successToast, errorToast} from "@utils/notify.ts";
    
    const urlParams = new URLSearchParams(window.location.search);
    const message = urlParams.get('message');

     if (message === 'authorized') {
        successToast('Bienvenido', 'Sesión iniciada.');
    }
</script>
  